---
title: "Heapstore"
url: "docs/heapstore"
tags: []
author: "Jiří Mayer"
datePublished: null
dateUpdated: "2023-05-31"
---

## Introduction

Heapstore is a Unisave component that lets you access the database directly from the game client. It is the best choice for storage of data, when you don't need complicated database queries or backend logic. As it can be used together with [facets](facets) and [entities](entities), it's best to start using Unisave with Heapstore and then learn the other, lower-level approaches when needed.

```
[image of how the game client directly reads and writes
documents in the database over the internet, through heapstore]
```


## Database structure

The [ArangoDB](https://www.arangodb.com/) database used by Unisave organizes data into *collections* and *documents*.

A database document is a [JSON](https://www.json.org/json-en.html) object, storing data about some entity (e.g. a player). A document might look like this:

```json
{
  "_id": "players/567349",
  "_key": "567349",
  "_rev": "_fJRP0i---",
  "name": "John Doe",
  "score": 42,
  "isBanned": false,
  "createdAt": "2023-05-31T08:21:40Z"
}
```

You can define your own fields (like `name`, `score`, `isBanned`, `createdAt`) and store your data in them. Each document might have different fields and you specify them when the document is created or updated.

Documents are organized into collections. Collection is a list of documents that somehow belong together. You can, for example, create a collection named `players` for all your registered players.

```
[image of the collection-document-data structure]
```

A document is identified by its `_key`. It has to be unique within the collection and can either be provided explicitly, or is auto-generated by the database during document creation. Since you typically want to also know the document's collection, it's best to use the `_id` field to identify a document. The `_id` field is simply the collection name and document key separated by a slash.


## Writing data

```cs
```


## API Reference


**`CollectionReference`**<br>
Identifies one collection of the database. Lets you access documents and perform queries.


### Documents

**`DocumentReference`**<br>
Identifies one document in the database (which may not exist though). The reference can be used to retrieve `DocumentSnapshot` instances and to create, update, or delete the document.

**`DocumentSnapshot`**<br>
Represents a document at a specific point in time. It contains extra metadata about changes if there was some previous snapshot. It is never `null`, missing document is represented by a special state. It is also implicitly castable to `Document`.

**`Document`**<br>
Similar to `DocumentSnapshot`, just missing the extra metadata. It is basically a glorified `JsonObject`. It's designed to be used in simpler usecases where temporal document differences are not needed to be watched. Also, here, non-existing document is represented by `null`.

It is primarily useful for queries that return at most one document. These queries can be executed by calling `.First()`, which cannot return an "empty" `DocumentSnapshot`, since a snapshot needs to know the document ID. But is not known for such a query.


### Queries

**`Query`**<br>
Identifies a list of documents in the database. It can be used to retrive them from the database as a `QuerySnapshot` instance. Analogous to `DocumentReference`, but for multiple documents.

**`QuerySnapshot`**<br>
Represents the value of a query at a specific point in time. It conains extra metadata about changes from a possible previous snapshot. It is never `null`. Analogous to `DocumentSnapshot`, but for multiple documents. Implicitly castable to `List<DocumentSnapshot>`.


